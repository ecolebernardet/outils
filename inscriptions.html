<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inscriptions - Gestion Classe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #000; color: #eee; padding: 10px; margin: 0; }
        
        /* THEME DYNAMIQUE */
        .theme-text-main { color: var(--theme-main) !important; }
        .theme-border { border-color: var(--theme-dark) !important; }
        .theme-bg-main { background-color: var(--theme-main) !important; }

        /* BOUTONS RADIO */
        .card-input { display: none; }
        .card-label {
            display: flex; align-items: center; justify-content: center;
            background: #1a1a1a; border: 2px solid #333;
            padding: 12px 5px; border-radius: 1rem; cursor: pointer;
            font-size: 0.7rem; font-weight: 700; text-transform: uppercase;
            transition: all 0.2s;
        }
        .card-input:checked + .card-label { background: var(--theme-main) !important; color: #000 !important; border-color: #fff; }

        /* STYLE CADRE BLANC (TON CODE ORIGINAL) */
        .student-item { 
            background-color: #ffffff !important; 
            padding: 6px 10px; 
            border-radius: 50px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 5px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            border: none;
        }

        .text-girl { color: #db2777 !important; } /* Rose */
        .text-boy { color: #2563eb !important; }  /* Bleu */
        
        .student-name { font-weight: 800; font-size: 0.65rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%; }

        .btn-nav { font-weight: 900; padding: 14px 4px; border-radius: 50px; font-size: 10px; text-align: center; text-transform: uppercase; }
        .active-scale:active { transform: scale(0.95); }

        .level-column { background: rgba(30, 30, 30, 0.6); border: 2px solid #333; border-radius: 1.2rem; padding: 10px; height: fit-content; }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-center text-xl font-black uppercase my-6 tracking-tighter italic">
            Gestion des <span class="theme-text-main">Inscriptions</span>
        </h1>
        
        <div class="max-w-md mx-auto bg-zinc-900 border-2 theme-border rounded-[2rem] p-6 mb-10 shadow-2xl">
            <form id="eleveForm" class="flex flex-col gap-5">
                <input type="text" id="nomComplet" placeholder="Prénom NOM" 
                    class="bg-black border-2 border-zinc-700 text-white rounded-xl p-4 outline-none focus:theme-border transition-colors text-sm" required>
                
                <div class="grid grid-cols-2 gap-3">
                    <label><input type="radio" name="sexe" value="m" class="card-input" checked><div class="card-label">Garçon</div></label>
                    <label><input type="radio" name="sexe" value="f" class="card-input"><div class="card-label">Fille</div></label>
                </div>

                <div class="grid grid-cols-3 gap-2" id="levelGrid"></div>

                <button type="submit" class="theme-bg-main text-black font-black py-4 rounded-full uppercase text-sm active-scale shadow-lg">Enregistrer l'élève</button>
            </form>
        </div>

        <div id="listeContainer" class="grid grid-cols-2 gap-2 px-1"></div>

        <div class="max-w-md mx-auto flex gap-4 mt-8 mb-20">
            <button onclick="toutEffacer()" class="btn-nav bg-zinc-800 text-red-400 border border-red-900/30 active-scale flex-1">RàZ Liste</button>
            <a href="index.html" class="btn-nav theme-bg-main text-black flex items-center justify-center no-underline shadow-md active-scale flex-1">Accueil</a>
        </div>
    </div>

    <script>
        // RÉCUPÉRATION DU THÈME DEPUIS LES PARAMÈTRES
        const prefs = JSON.parse(localStorage.getItem('theme_tuiles')) || { inscr: 'lime' };
        const selectedColor = prefs.inscr || 'lime';

        // Conversion des noms de couleurs en codes Hexa (ou variables Tailwind)
        // Note: Pour faire simple et garder ton système, on utilise un petit dictionnaire
        const colorMap = {
            red: '#ef4444', orange: '#f97316', amber: '#f59e0b', yellow: '#eab308',
            lime: '#bef264', green: '#22c55e', emerald: '#10b981', teal: '#14b8a6',
            cyan: '#06b6d4', sky: '#0ea5e9', blue: '#3b82f6', indigo: '#6366f1',
            violet: '#8b5cf6', purple: '#a855f7', fuchsia: '#d946ef', pink: '#ec4899',
            rose: '#f43f5e', slate: '#64748b', gray: '#6b7280', zinc: '#71717a',
            neutral: '#737373', stone: '#78716c'
        };

        const mainColor = colorMap[selectedColor] || colorMap.lime;
        document.documentElement.style.setProperty('--theme-main', mainColor);
        document.documentElement.style.setProperty('--theme-dark', mainColor + '66'); // Version semi-transparente pour les bords

        // Niveaux (Ton code original)
        const levels = ['CP','CE1','CE2','CM1','CM2','AUTRE'];
        const levelGrid = document.getElementById('levelGrid');
        levels.forEach(l => {
            levelGrid.innerHTML += `<label><input type="radio" name="niveau" value="${l}" class="card-input" ${l==='CE2'?'checked':''}><div class="card-label">${l}</div></label>`;
        });

        let eleves = JSON.parse(localStorage.getItem('maListeEleves')) || [];

        function formatName(identite) {
            const parts = identite.trim().split(' ');
            const prenom = parts[0].charAt(0).toUpperCase() + parts[0].slice(1).toLowerCase();
            const nom = parts.slice(1).join(' ').toUpperCase();
            return `${prenom} ${nom}`;
        }

        document.getElementById('eleveForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const identite = document.getElementById('nomComplet').value;
            const sexe = document.querySelector('input[name="sexe"]:checked').value;
            const niveau = document.querySelector('input[name="niveau"]:checked').value;
            eleves.push({ id: Date.now(), identite, sexe, niveau });
            sauvegarder();
            e.target.reset();
            document.getElementById('nomComplet').focus();
        });

        function sauvegarder() {
            localStorage.setItem('maListeEleves', JSON.stringify(eleves));
            render();
        }

        function render() {
            const container = document.getElementById('listeContainer');
            container.innerHTML = "";
            if (eleves.length === 0) return;

            const groupes = {};
            eleves.forEach(el => {
                if (!groupes[el.niveau]) groupes[el.niveau] = [];
                groupes[el.niveau].push(el);
            });

            const nomsNiveaux = Object.keys(groupes).sort();

            nomsNiveaux.forEach(niv => {
                const col = document.createElement('div');
                col.className = "level-column";
                col.innerHTML = `
                    <div class="flex justify-between items-center mb-2 border-b border-zinc-800 pb-1">
                        <h3 class="text-[9px] font-black theme-text-main uppercase tracking-tighter">${niv}</h3>
                        <span class="bg-zinc-800 text-white text-[8px] px-1.5 py-0.5 rounded-full font-bold">${groupes[niv].length}</span>
                    </div>`;
                
                groupes[niv].sort((a,b) => a.identite.localeCompare(b.identite)).forEach(el => {
                    const genderClass = el.sexe === 'f' ? 'text-girl' : 'text-boy';
                    const item = document.createElement('div');
                    item.className = "student-item";
                    item.innerHTML = `
                        <span class="student-name ${genderClass}">${formatName(el.identite)}</span>
                        <button onclick="supprimer(${el.id})" class="text-zinc-400 hover:text-red-600 text-lg font-bold">&times;</button>
                    `;
                    col.appendChild(item);
                });
                container.appendChild(col);
            });
        }

        function supprimer(id) { eleves = eleves.filter(e => e.id !== id); sauvegarder(); }
        function toutEffacer() { if(confirm("Supprimer toute la liste ?")) { eleves = []; sauvegarder(); } }

        render();
    </script>
</body>
</html>